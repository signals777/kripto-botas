<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <title>AI Demo Kripto Bot Panelė</title>
    <style>
        body { background: #232734; color: #fff; font-family: Arial; }
        .container { max-width: 950px; margin: 25px auto; background: #232734; border-radius: 15px; padding: 25px; }
        h2 { color: #7DF364; }
        label, span { color: #fff; }
        .btn { padding: 8px 18px; margin: 2px; border-radius: 8px; border: none; font-weight: bold; }
        .btn-green { background: #32CD32; color: #fff; }
        .btn-red { background: #E84646; color: #fff; }
        .btn-blue { background: #399AF5; color: #fff; }
        table { width: 100%; border-collapse: collapse; margin-top: 25px; background: #222; }
        th, td { border: 1px solid #333; padding: 5px 6px; font-size: 14px; text-align: center; }
        th { background: #1e1e26; color: #70ff94; }
        .green { color: #32CD32; font-weight: bold; }
        .red { color: #FF3333; font-weight: bold; }
    </style>
    <!-- Chart.js grafikui -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
    <h2>AI Kripto Demo Panelė</h2>
    <div style="font-size:18px;margin-bottom:10px;">
        <b>Balansas:</b> <span style="color:gold;font-size:20px;">{{ demo_balance }} USDT</span><br>
        <b>Boto būsena:</b>
        <span style="color: {{ 'limegreen' if bot_status == 'Veikia' else 'crimson' }};">
            {{ bot_status }}
        </span>
    </div>

    <!-- Nustatymai -->
    <form method="POST" style="display:inline-block;margin-bottom:14px;">
        <!-- Nėra ciklo trukmės laukelio -->
        Porų kiekis:
        <input type="number" name="n_pairs" value="{{ settings['n_pairs'] }}" min="5" max="200" style="width: 50px;" />

        TA Filtrai:
        <label><input type="checkbox" name="ta_ema" {% if settings.get('ta_ema', True) %}checked{% endif %}>EMA</label>
        <label><input type="checkbox" name="ta_macd" {% if settings.get('ta_macd', True) %}checked{% endif %}>MACD</label>
        <label><input type="checkbox" name="ta_bb" {% if settings.get('ta_bb', True) %}checked{% endif %}>BB</label>
        <label><input type="checkbox" name="ta_rsi" {% if settings.get('ta_rsi', True) %}checked{% endif %}>RSI</label>

        <button class="btn btn-blue" type="submit">Atnaujinti nustatymus</button>
    </form>

    <a class="btn btn-blue" href="{{ url_for('refresh') }}">Atnaujinti</a>
    <a class="btn btn-green" href="{{ url_for('start_bot') }}">Paleisti</a>
    <a class="btn btn-red" href="{{ url_for('stop_bot') }}">Stabdyti</a>

    <div style="margin:12px 0;font-size:13px;">
        <b>AI analizė veikia nuolat – sandoriai vykdomi realiu laiku pagal signalus.</b>
    </div>

    <!-- Grafikas -->
    <h3>BALANSO GRAFIKAS</h3>
    <canvas id="balansoGrafikas" height="50"></canvas>

    <!-- Sandorių lentelė -->
    <table>
        <tr>
            <th>Laikas</th>
            <th>Pora</th>
            <th>Kryptis</th>
            <th>Kaina</th>
            <th>Pelnas (USDT)</th>
            <th>Procentai (%)</th>
            <th>Komisinis (USDT)</th>
            <th>Balansas</th>
        </tr>
        {% for t in trade_history[:50] %}
        <tr>
            <td>{{ t.laikas }}</td>
            <td>{{ t.pora }}</td>
            <td>{{ t.kryptis }}</td>
            <td>{{ t.kaina }}</td>
            <td class="{{ 'green' if t.pelnas >=0 else 'red' }}">{{ t.pelnas }}</td>
            <td>{{ t.procentai }}</td>
            <td>{{ t.komisinis }}</td>
            <td>{{ t.balansas }}</td>
        </tr>
        {% endfor %}
    </table>
</div>

<script>
const ctx = document.getElementById('balansoGrafikas').getContext('2d');
const balansoData = {{ graph|tojson }};
const labels = {{ times|tojson }};
const grafikas = new Chart(ctx, {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'Balansas (USDT)',
            data: balansoData,
            fill: false,
            borderColor: 'limegreen',
            tension: 0.18
        }]
    },
    options: {
        plugins: {
            legend: { display: false }
        },
        scales: {
            y: { beginAtZero: false }
        }
    }
});
</script>
</body>
</html>
